# พื้นฐานการเตรียมข้อมูลอนุกรมเวลาก่อนการพยากรณ์ด้วยเทคนิคที่ซับซ้อน

จากการค้นคว้าเพิ่มเติม การเตรียมข้อมูลอนุกรมเวลาก่อนการพยากรณ์นั้นครอบคลุมมากกว่าแค่การทำให้ข้อมูลมีความคงที่ (stationarity) เพียงอย่างเดียว การเตรียมข้อมูลที่ครบถ้วนช่วยให้โมเดลจับรูปแบบในข้อมูลได้ดีขึ้น ลดความผิดพลาดในการพยากรณ์ และทำให้ผลลัพธ์มีความน่าเชื่อถือมากขึ้น

## 1. การจัดการปัญหาคุณภาพข้อมูลเบื้องต้น

ก่อนเริ่มวิเคราะห์รูปแบบใดๆ ต้องแก้ไขปัญหาพื้นฐานที่มักพบในข้อมูลอนุกรมเวลา:

- **การจัดการค่าที่หายไป (Missing Values)**: ช่องว่างในอนุกรมเวลาทำให้เกิดการขาดตอนของรูปแบบ วิธีแก้ไขเช่น การประมาณค่าด้วย linear interpolation, forward/backward fill หรือการใช้ค่าเฉลี่ยที่คำนึงถึงฤดูกาล

- **การจัดการค่าผิดปกติ (Outliers)**: ค่าผิดปกติสามารถบิดเบือนการวิเคราะห์แนวโน้มและความแปรปรวน ควรใช้ความรู้ในโดเมนหรือวิธีทางสถิติ (IQR, z-scores) เพื่อปรับหรือกำจัดค่าเหล่านี้

ปัญหาคุณภาพข้อมูลที่ไม่ได้รับการแก้ไขจะส่งผลกระทบต่อทุกขั้นตอนถัดไป รวมถึงการทดสอบความคงที่และการสร้างคุณลักษณะ

## 2. การสร้างความสม่ำเสมอของเวลา

อนุกรมเวลามักมีช่วงเวลาที่ไม่สม่ำเสมอ ซึ่งต้องได้รับการแก้ไข:

- **การปรับความถี่ข้อมูล (Resampling)**: แปลงข้อมูลให้มีช่วงเวลาที่สม่ำเสมอ เช่น จากรายชั่วโมงเป็นรายวัน โดยใช้การรวม (aggregation) หรือการเติมข้อมูล
- **การปรับเวลาให้ตรงกัน (Alignment)**: มาตรฐานเวลาให้สอดคล้องกัน เช่น การปรับ timezone

โมเดลอนุกรมเวลามักสมมติว่าข้อมูลมีช่วงเวลาที่สม่ำเสมอ ข้อมูลที่ไม่สม่ำเสมออาจทำให้การวิเคราะห์แนวโน้มและการสร้างคุณลักษณะผิดพลาด

## 3. การแยกองค์ประกอบของอนุกรมเวลา

การแยกองค์ประกอบช่วยให้เข้าใจรูปแบบที่ซ่อนอยู่ในข้อมูล:

- **แนวโน้ม (Trend)**: ทิศทางระยะยาว
- **ฤดูกาล (Seasonality)**: รูปแบบที่เกิดซ้ำเป็นวงจร
- **ส่วนที่เหลือ (Residuals)**: ความผันผวนที่ไม่ได้อธิบายโดยองค์ประกอบอื่น

เครื่องมือที่ใช้ เช่น STL decomposition, classical decomposition หรือ moving averages

การแยกองค์ประกอบช่วยตัดสินใจว่าควรสร้างโมเดลแยกสำหรับแต่ละองค์ประกอบ (เช่น ใช้ SARIMA) หรือควรสร้างคุณลักษณะเพิ่มเติม (เช่น ตัวแปรหุ่นตามฤดูกาล) นอกจากนี้ยังช่วยให้เข้าใจว่าจำเป็นต้องทำให้ข้อมูลคงที่หรือไม่ (ส่วนที่เหลืออาจมีความคงที่อยู่แล้ว)

## 4. การทำให้ข้อมูลมีความคงที่ (Stationarity)

ความคงที่เป็นคุณสมบัติสำคัญแต่เป็นเพียงส่วนหนึ่งของกระบวนการเตรียมข้อมูล:

- **การหาความแตกต่าง (Differencing)**: ลดแนวโน้มโดยการลบค่าก่อนหน้า (Δyₜ = yₜ - yₜ₋₁)
- **การแปลงข้อมูล (Transformations)**: Log หรือ Box-Cox transformation ช่วยให้ความแปรปรวนคงที่

หากการแยกองค์ประกอบได้กำจัดแนวโน้มและฤดูกาลออกไปแล้ว ส่วนที่เหลืออาจไม่จำเป็นต้องทำ differencing ความคงที่มีความสำคัญสำหรับโมเดลอย่าง ARIMA แต่อาจไม่จำเป็นสำหรับโมเดล machine learning หากมีการสร้างคุณลักษณะที่จับองค์ประกอบที่ไม่คงที่ได้

## 5. การสร้างคุณลักษณะ (Feature Engineering)

การแปลงอนุกรมเวลาดิบให้เป็นสัญญาณที่มีความสามารถในการทำนาย:

- **ตัวแปรล่าช้า (Lagged Variables)**: จับรูปแบบ autoregressive (เช่น yₜ₋₁, yₜ₋₂)
- **สถิติเคลื่อนที่ (Rolling Statistics)**: ค่าเฉลี่ยเคลื่อนที่/ส่วนเบี่ยงเบนมาตรฐานช่วยเน้นแนวโน้มในท้องถิ่น
- **คุณลักษณะเกี่ยวกับเวลา (Time-Based Features)**: เข้ารหัสฤดูกาลผ่านชั่วโมง/วัน/เดือนหรือวันหยุด
- **ฟูเรียร์เทอม (Fourier Terms)**: จำลองฤดูกาลที่ซับซ้อนด้วยคลื่นไซน์/โคไซน์

โมเดล machine learning (เช่น LSTM, XGBoost) ต้องอาศัยคุณลักษณะที่ชัดเจน แม้แต่โมเดลดั้งเดิมก็ได้ประโยชน์จากสัญญาณที่สร้างขึ้นซึ่ง "อธิบาย" ความไม่คงที่

## 6. การปรับมาตราส่วน (Scaling)

การปรับให้คุณลักษณะอยู่ในช่วงที่เปรียบเทียบกันได้:

- สำคัญสำหรับโมเดลที่ใช้ gradient (เช่น neural networks) และอัลกอริทึมที่ใช้ระยะทาง (เช่น k-NN)
- ควรปรับมาตราส่วน *หลังจาก* การสร้างคุณลักษณะเพื่อรวมตัวแปรทั้งหมด (เช่น lags, rolling stats)

## 7. การตรวจสอบความใช้ได้เชิงเวลา (Temporal Validation)

- **การแบ่งตามเวลา (Time-Based Split)**: สำรองข้อมูลล่าสุดสำหรับการทดสอบ (เช่น 20% สุดท้ายตามลำดับเวลา)
- **การตรวจสอบแบบเดินหน้า (Walk-Forward Validation)**: จำลองการอัปเดตในโลกจริงโดยขยายหน้าต่างการฝึกฝนทีละน้อย

การแบ่งแบบสุ่มละเมิดลำดับเวลา ซึ่งทำให้เมตริกประสิทธิภาพสูงเกินจริง

## ความเชื่อมโยงและความสำคัญ

แต่ละขั้นตอนส่งต่อไปยังขั้นตอนถัดไป:
- ข้อมูลที่สะอาดและมีโครงสร้างช่วยให้การแยกองค์ประกอบแม่นยำ
- การแยกองค์ประกอบช่วยกำหนดแนวทางความคงที่และการออกแบบคุณลักษณะ
- การสร้างคุณลักษณะช่วยชดเชยหรือเสริมความคงที่
- การตรวจสอบที่เหมาะสมช่วยให้มั่นใจว่าการเลือกการเตรียมข้อมูลสามารถนำไปใช้กับข้อมูลในอนาคตได้

การรวมขั้นตอนเหล่านี้ทำให้การเตรียมข้อมูลเป็นกระบวนการองค์รวม ซึ่งความคงที่เป็นส่วนประกอบที่สำคัญแต่ไม่ใช่จุดโฟกัสเพียงอย่างเดียว วิธีนี้ช่วยให้มั่นใจว่าโมเดลได้รับข้อมูลที่สะอาด มีสารสนเทศ และมีความสอดคล้องเชิงเวลา ซึ่งช่วยเพิ่มความแม่นยำในการพยากรณ์