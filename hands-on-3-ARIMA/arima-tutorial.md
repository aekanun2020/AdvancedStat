# การวิเคราะห์และเลือกพารามิเตอร์สำหรับโมเดล ARIMA/SARIMA

## โมเดล ARIMA คืออะไร

ARIMA (AutoRegressive Integrated Moving Average) เป็นโมเดลทางสถิติสำหรับการวิเคราะห์และพยากรณ์อนุกรมเวลา ประกอบด้วยองค์ประกอบ 3 ส่วนหลัก:

- **AR (AutoRegressive)**: ส่วนที่แสดงความสัมพันธ์ระหว่างค่าปัจจุบันกับค่าในอดีต
- **I (Integrated)**: ส่วนที่เกี่ยวข้องกับการทำ differencing เพื่อให้ข้อมูลมีความคงที่
- **MA (Moving Average)**: ส่วนที่แสดงความสัมพันธ์ระหว่างค่าปัจจุบันกับค่าความคลาดเคลื่อนในอดีต

โมเดล ARIMA มักเขียนในรูปแบบ ARIMA(p,d,q) โดยที่:
- **p** คือจำนวนเทอม AR (AutoRegressive)
- **d** คือจำนวนครั้งที่ต้องทำ differencing
- **q** คือจำนวนเทอม MA (Moving Average)

## โมเดล SARIMA คืออะไร

SARIMA (Seasonal ARIMA) เป็นการขยายโมเดล ARIMA เพื่อรองรับข้อมูลที่มีองค์ประกอบฤดูกาล มักเขียนในรูปแบบ SARIMA(p,d,q)(P,D,Q,m) โดยที่:
- **p, d, q** คือพารามิเตอร์ non-seasonal เหมือนใน ARIMA
- **P** คือจำนวนเทอม Seasonal AR
- **D** คือจำนวนครั้งที่ต้องทำ seasonal differencing
- **Q** คือจำนวนเทอม Seasonal MA
- **m** คือความยาวของฤดูกาล (เช่น 7 สำหรับรายสัปดาห์, 12 สำหรับรายเดือน)

## การเลือกพารามิเตอร์ที่เหมาะสม

การเลือกพารามิเตอร์ที่เหมาะสมสำหรับโมเดล ARIMA/SARIMA มีขั้นตอนดังนี้:

### 1. การกำหนดค่า d และ D (การทำให้ข้อมูลมีความคงที่)

**การกำหนดค่า d**:
- วิเคราะห์ความคงที่ของข้อมูลด้วยการดูกราฟและทดสอบทางสถิติ (เช่น ADF test, KPSS test)
- ถ้าข้อมูลมีความคงที่อยู่แล้ว: d = 0
- ถ้าข้อมูลไม่มีความคงที่ แต่ผลต่างอันดับที่ 1 มีความคงที่: d = 1
- ถ้าผลต่างอันดับที่ 1 ยังไม่มีความคงที่ แต่ผลต่างอันดับที่ 2 มีความคงที่: d = 2

**การกำหนดค่า D** (สำหรับ SARIMA):
- ดูว่ามีรูปแบบซ้ำๆ ทุกช่วงฤดูกาลหรือไม่
- ถ้าไม่จำเป็นต้องทำ seasonal differencing: D = 0
- ถ้าต้องทำ seasonal differencing 1 ครั้ง: D = 1

### 2. การวิเคราะห์ ACF และ PACF เพื่อกำหนดค่า p, q, P, Q

การวิเคราะห์กราฟ ACF และ PACF เป็นขั้นตอนสำคัญในการกำหนดค่า p, q, P, Q โดยต้องดูกราฟหลังจากทำ differencing แล้ว

**การวิเคราะห์ค่า p และ q**:

- **การกำหนดค่า p**:
  - ดูกราฟ PACF ว่ามีการตัด (cut off) หลัง lag ใด
  - ถ้า PACF ตัดหลัง lag p แสดงว่าควรใช้ AR(p)
  - "ตัด" หมายถึงค่าหลัง lag นั้นไม่มีนัยสำคัญ (อยู่ในพื้นที่สีฟ้า)

- **การกำหนดค่า q**:
  - ดูกราฟ ACF ว่ามีการตัด (cut off) หลัง lag ใด
  - ถ้า ACF ตัดหลัง lag q แสดงว่าควรใช้ MA(q)

**การวิเคราะห์ค่า P และ Q** (สำหรับ SARIMA):
- ดู ACF และ PACF ที่ lag ที่เป็นจำนวนเท่าของ m (เช่น m, 2m, 3m, ...)
- ใช้หลักการเดียวกับการหา p และ q
- ถ้า PACF ตัดหลัง lag s×P แสดงว่าควรใช้ Seasonal AR(P)
- ถ้า ACF ตัดหลัง lag s×Q แสดงว่าควรใช้ Seasonal MA(Q)

### 3. รูปแบบทั่วไปที่พบได้บ่อย

1. **AR(p)**:
   - ACF: ลดลงอย่างช้าๆ (decay gradually)
   - PACF: ตัดหลัง lag p

2. **MA(q)**:
   - ACF: ตัดหลัง lag q
   - PACF: ลดลงอย่างช้าๆ (decay gradually)

3. **ARMA(p,q)**:
   - ACF: ลดลงอย่างช้าๆ หลัง lag q
   - PACF: ลดลงอย่างช้าๆ หลัง lag p

4. **ไม่มีความคงที่ (Non-stationary)**:
   - ACF: ลดลงอย่างช้ามาก แทบไม่ลดลงเลย
   - ต้องทำ differencing (d ≥ 1)

## หลักการตีความกราฟ ACF และ PACF

### ความหมายของ "มีนัยสำคัญ" ในกราฟ ACF และ PACF:

- ในกราฟ ACF และ PACF มีแถบสีฟ้าอ่อนแสดงขอบเขตความเชื่อมั่น (ประมาณ ±1.96/√n ที่ระดับความเชื่อมั่น 95%)
- แท่งที่ยื่นพ้นพื้นที่สีฟ้า = **มีนัยสำคัญทางสถิติ**
- แท่งที่อยู่ภายในพื้นที่สีฟ้า = **ไม่มีนัยสำคัญทางสถิติ**
- การที่ค่าเป็นบวกหรือลบไม่เปลี่ยนวิธีการตีความ เราพิจารณาที่ "ขนาด" ไม่ใช่เครื่องหมาย
- ค่าลบแสดงถึงความสัมพันธ์แบบผกผัน (เมื่อค่าในอดีตสูง ค่าปัจจุบันมีแนวโน้มต่ำ)

### ข้อสังเกตเพิ่มเติม:

1. **รูปแบบฤดูกาล**:
   - มีค่า spike ที่ lag ที่เป็นจำนวนเท่าของฤดูกาล (เช่น 7, 14, 21... สำหรับข้อมูลรายวันที่มีรูปแบบรายสัปดาห์)

2. **หลังการทำ differencing**:
   - มักพบค่าลบที่ lag 1 ใน ACF ซึ่งเป็นปกติ
   - ถ้ายังมีค่าที่มีนัยสำคัญหลาย lag และลดลงช้า อาจต้องทำ differencing เพิ่ม

3. **ความซับซ้อนของโมเดล**:
   - ตามหลัก parsimony (ความประหยัด) ควรเลือกโมเดลที่เรียบง่ายที่สุดที่อธิบายข้อมูลได้ดี
   - ระวังการ over-parameterization ซึ่งอาจนำไปสู่ overfitting

## ตัวอย่างการวิเคราะห์

### ตัวอย่าง 1: ข้อมูลไม่มีความคงที่
- ACF: ลดลงช้ามาก เกือบเป็นเส้นตรง
- การดำเนินการ: ทำ differencing (d=1) แล้วประเมิน ACF และ PACF อีกครั้ง

### ตัวอย่าง 2: หลังทำ First-order Differencing
- ACF: มีค่านัยสำคัญที่ lag 1 (ลบ) และไม่มีนัยสำคัญหลังจากนั้น
- PACF: มีค่านัยสำคัญที่ lag 1 (ลบ) และไม่มีนัยสำคัญหลังจากนั้น
- สรุป: ARIMA(1,1,1)

### ตัวอย่าง 3: ข้อมูลมีองค์ประกอบฤดูกาล
- ACF: มีค่านัยสำคัญที่ lag 1 และที่ lag 12, 24, 36 (สำหรับข้อมูลรายเดือน)
- PACF: มีค่านัยสำคัญที่ lag 1 และ lag 12
- สรุป: SARIMA(1,1,0)(1,0,0,12)

## ข้อแนะนำในการปฏิบัติ

1. **เริ่มจากข้อมูล**: ทำความเข้าใจข้อมูลและรูปแบบการเปลี่ยนแปลงก่อน
2. **ทดสอบความคงที่**: ใช้ทั้งการวิเคราะห์ด้วยสายตาและการทดสอบทางสถิติ
3. **ทำ differencing ตามความจำเป็น**: กำหนดค่า d และ D ที่เหมาะสม
4. **วิเคราะห์ ACF และ PACF**: หลังจากข้อมูลมีความคงที่แล้ว
5. **ทดลองหลายโมเดล**: เปรียบเทียบประสิทธิภาพของหลายโมเดลที่มีค่า p, q ต่างกัน
6. **พิจารณาใช้ Auto-ARIMA**: ในกรณีที่การตีความ ACF และ PACF ไม่ชัดเจน

Auto-ARIMA เป็นเครื่องมือที่ช่วยหาพารามิเตอร์ที่เหมาะสมโดยอัตโนมัติ ซึ่งมีประโยชน์มากในกรณีที่รูปแบบ ACF และ PACF ซับซ้อนหรือไม่ชัดเจน

## สรุป

การเลือกพารามิเตอร์ที่เหมาะสมสำหรับโมเดล ARIMA/SARIMA ต้องอาศัยการวิเคราะห์ข้อมูลอย่างระมัดระวัง การทดสอบความคงที่ และการตีความกราฟ ACF และ PACF อย่างถูกต้อง แม้ว่าจะมีเทคนิค Auto-ARIMA ที่ช่วยในการหาพารามิเตอร์ แต่ความเข้าใจพื้นฐานในการวิเคราะห์ด้วยตนเองยังคงมีความสำคัญในการทำความเข้าใจข้อมูลและตรวจสอบความเหมาะสมของโมเดล